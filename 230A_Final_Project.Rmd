---
title: "STAT 230A Final Project Code"
author: "Andrew Du"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
library(foreign)
library(knitr)
library(kableExtra)
library(sandwich)
library(haven)
library(lmtest)
library(MASS)
library(mfx)
library(prediction)
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
setwd('/Users/du/Documents/sp24/stat230a/final_project/wfh')
install.packages("/Users/du/Documents/sp24/stat230a/final_project/wfh/prediction_0.3.17.tar.gz", type = "source", repos = NULL)
install.packages("/Users/du/Documents/sp24/stat230a/final_project/wfh/margins_0.3.26.1.tar.gz", type = "source", repos = NULL)
library(prediction)
library(margins)
```

```{r}
library(devtools)
load_all("mfx")
```

## Table 1

Redoing analyses from table 1, but with logit regression and robust standard error for all

Original table:

```{r table 1}
summary_volunteer_data <- read.dta("data/summary_volunteer.dta")
summary_volunteer_data$children <- ifelse(summary_volunteer_data$children == "yes", 1.0, 0.0)
summary_volunteer_data$bedroom <- ifelse(summary_volunteer_data$bedroom == "yes", 1.0, 0.0)
summary_volunteer_data
```

```{r}
table_1_formulas <- list(
  volunteer ~ children, 
  volunteer ~ married, 
  volunteer ~ children + married + commute + bedroom, 
  volunteer ~ children + married + commute + bedroom + high_educ + tenure,
  volunteer ~ children + married + commute + bedroom + high_educ + tenure + grosswage,
  volunteer ~ grosswage,
  volunteer ~ children + married + commute + bedroom + high_educ + tenure + grosswage + age + men
  )
```

```{r}
compare_logit_probit <- function(formula, data, robust=FALSE, ehw_type="HC1") {
  model_probit <- probitmfx(formula, data=data, robust=robust, robust_type=ehw_type)
  model_logit <- logitmfx(formula, data=data, robust=robust, robust_type=ehw_type)
  
  if (robust) {
    cat("probit model average marginal effect with", ehw_type, "error:", "\n")
    print(model_probit$mfxest)
    cat("logit model average marginal effect with", ehw_type, "error:", "\n")
    print(model_logit$mfxest)
  } else {
    cat("probit model average marginal effect with standard error:", "\n")
    print(model_probit$mfxest)
    cat("logit model average marginal effect with standard error:", "\n")
    print(model_logit$mfxest)
  }
}
```

```{r}

formula <- volunteer ~ children + married + commute + bedroom

compare_logit_probit(formula, data = summary_volunteer_data, robust=TRUE, ehw_type="HC0")

cat("\n")

compare_logit_probit(formula, data = summary_volunteer_data, robust=TRUE, ehw_type="HC1")
```

```{r}

# Column (1): dprobit volunteer children
model1 <- glm(volunteer ~ children, data = summary_volunteer_data, family = binomial(link = "probit"))
model1_logistic <- glm(volunteer ~ children, data = summary_volunteer_data, family = binomial(link = "logit"))
model1_mfx <- probitmfx(volunteer ~ children, data = summary_volunteer_data, robust=TRUE)
model1_mfx_hc1 <- probitmfx(volunteer ~ children, data = summary_volunteer_data, robust=TRUE, robust_type="HC1")
model1_mfx_nonrob <- probitmfx(volunteer ~ children, data = summary_volunteer_data, robust=FALSE)

# Column (2): dprobit volunteer married
model2 <- glm(volunteer ~ married, data = summary_volunteer_data, family = binomial(link = "probit"))

# Column (3): dprobit volunteer children married commute bedroom
model3 <- glm(volunteer ~ children + married + commute + bedroom, data = summary_volunteer_data, family = binomial(link = "probit"))

# Column (4): dprobit volunteer children married commute bedroom high_educ tenure
model4 <- glm(volunteer ~ children + married + commute + bedroom + high_educ + tenure, data = summary_volunteer_data, family = binomial(link = "probit"))

# Column (5): dprobit volunteer children married commute bedroom high_educ tenure grosswage
model5 <- glm(volunteer ~ children + married + commute + bedroom + high_educ + tenure + grosswage, data = summary_volunteer_data, family = binomial(link = "probit"))

# Column (6): dprobit volunteer grosswage
model6 <- glm(volunteer ~ grosswage, data = summary_volunteer_data, family = binomial(link = "probit"))

# Column (7): dprobit volunteer children married commute bedroom high_educ tenure grosswage age men
model7 <- glm(volunteer ~ children + married + commute + bedroom + high_educ + tenure + grosswage + age + men, data = summary_volunteer_data, family = binomial(link = "probit"))

print(coeftest(model1, vcov = vcovHC(model1, type="HC1")))

print(coeftest(model1_logistic, vcov = vcovHC(model1, type="HC1")))

marginal_effects <- margins(model1)
#print(marginal_effects)
print(model1_mfx$mfxest)
print(model1_mfx_hc1$mfxest)
print(model1_mfx_nonrob$mfxest)

print(coeftest(model2, vcov = vcovHC(model2, type="HC1")))
print(coeftest(model3, vcov = vcovHC(model3, type="HC1")))
print(coeftest(model4, vcov = vcovHC(model4, type="HC1")))
print(coeftest(model5, vcov = vcovHC(model5, type="HC1")))
print(coeftest(model6, vcov = vcovHC(model6, type="HC1")))
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
